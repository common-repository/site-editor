!function(a){a.fn.sedDraggable=function(b){function c(b,c){var e=H;if("clone"==c.helper){U=!0,V=e.clone().removeAttr("id").offset({left:I.left,top:I.top}).appendTo(a("body"));var f=V.offset();return W=f.left-b.pageX,X=f.top-b.pageY,V.css("position","absolute"),d(),N={left:I.left,top:I.top},!1}}function d(){M={width:V.outerWidth(),height:V.outerHeight()}}function e(a,c){var d;null!=aa?(ba.attr("current-sortable-item","yes"),d={helper:V,item:ba,direction:S,placeHolder:ca,sortable:aa,handle:F},j(),b.sortStop(a,d)):null!==Z?k(a):g(a),h()}function f(b){a.SiteEditorDroppable.currentIframe=a.SiteEditorDroppable.targetIframe(b.pageX,b.pageY);var c=a.SiteEditorDroppable.droppables[a.SiteEditorDroppable.currentIframe];if(0==c.length)return!1;for(var d=null,e=c.length-1;e>=0;e--){var f="parent"==c[e].targetWindow?a(c[e].selector):c[e].targetWindow.jQuery(c[e].selector);if(f.each(function(f,g){m(a(this),b.pageX,b.pageY,a.SiteEditorDroppable.currentIframe)&&(d=a(this),P=c[e])}),null!=d)break}return null!==d&&(null!==Z&&Z.length>0&&Z.removeClass("sed-row-drop-area"),void(Z=d))}function g(a){null!=V&&(b.revert===!0?V.animate(I,parseInt(b.revertDuration,10),function(){j()}):j())}function h(){U=!1,W=0,X=0}function j(){null!=V&&(null!=ca&&ca.remove(),$=[],_=[],aa=null,ca=null,Y=!1,V.remove(),V=null)}function k(a){Z.attr("current-droppable-item","yes");var b={helper:V,droppable:Z,handle:F,offset:l()};P.options.drop(a,b),Z.removeClass("sed-row-drop-area"),Z=null,null!=ca&&ca.remove(),$=[],_=[],aa=null,ca=null,Y=!1,V.remove(),V=null}function l(){var b=V.offset(),c=a.SiteEditorDroppable.currentIframe||"parent";if("parent"==c)return{left:b.left,top:b.top};if(void 0!==typeof a.SiteEditorDroppable.scope[c])var d=a.SiteEditorDroppable.scope[c].top,e=a.SiteEditorDroppable.scope[c].left;else var d=a(c).offset().top,e=a(c).offset().left;return{top:b.top+a("#"+c).contents().scrollTop()-d,left:b.left+a("#"+c).contents().scrollLeft()-e}}function m(b,c,d,e){if("parent"==e){var f=b.offset().top-a(window).scrollTop(),g=b.offset().left-a(window).scrollLeft();return c>=g&&c<=g+b.width()&&d>=f&&d<=f+b.height()}if(void 0!==typeof a.SiteEditorDroppable.scope[e])var h=a.SiteEditorDroppable.scope[e].top,i=a.SiteEditorDroppable.scope[e].left;else var h=a("#"+e).offset().top,i=a("#"+e).offset().left;var f=b.offset().top-a("#"+e).contents().scrollTop()+(h-a(window).scrollTop()),g=b.offset().left-a("#"+e).contents().scrollLeft()+(i-a(window).scrollLeft());return c>=g&&c<=g+b.width()&&d>=f&&d<=f+b.height()}function n(b,c){var d,e,f,g,h=a.SiteEditorDroppable.currentIframe=a.SiteEditorDroppable.targetIframe(b.pageX,b.pageY);"parent"==h?(d=a(document),e=0,targetHeight=a(window).height()):(d=a("#"+h).contents(),e=a.SiteEditorDroppable.scope[h].top-a(window).scrollTop(),targetHeight=a("#"+h).height()),g=d.height(),f=g-targetHeight,f>0&&(targetHeight-(b.pageY-e)<c.scrollSensitivity&&d.scrollTop()<f?d.scrollTop(d.scrollTop()+c.scrollSpeed):b.pageY-e<c.scrollSensitivity&&d.scrollTop()>0&&d.scrollTop(d.scrollTop()-c.scrollSpeed),d.scrollTop()<0&&d.scrollTop(0),d.scrollTop()>f&&d.scrollTop(f))}function o(){J={left:parseInt(H.css("marginLeft"),10)||0,top:parseInt(H.css("marginTop"),10)||0,right:parseInt(H.css("marginRight"),10)||0,bottom:parseInt(H.css("marginBottom"),10)||0}}function p(a,c,d){if(null!=aa){var e;if(e=b.cancelSortable!==!1?b.items!==!1?aa.children(b.items).not(b.cancelSortable):aa.children().not(b.cancelSortable):b.items!==!1?aa.children(b.items):aa.children(),0==e.length)return ca.appendTo(aa),ba=aa,void(S="none");for(i=$.length-1;i>=0;i--)if(item=$[i],intersection=w(item,a),intersection&&item.instance[0]===aa[0]){ba=item.item,S=1===intersection?"down":"up",q(a,item);break}R=N}}function q(a,b,c,d){b.item[0].parentNode.insertBefore(ca[0],"down"===S?b.item[0]:b.item[0].nextSibling),T=T?++T:1;var e=T;r(function(){e===T&&z(!d)})}function r(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)}function s(){var c,d;c=b.placeholder!==!1&&"string"==typeof b.placeholder?b.placeholder:"<div class='sortable-placeholder'></div>",d=a(c).addClass("sed-sortable-placeholder ui-sortable-placeholder"),ca=d}function u(a,b,c){return a>b&&a<b+c}function v(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}function w(c){var d=b.iframeSortable;if("parent"==d)var e=c.left,f=c.top,g="x"===b.axis||u(N.top+O.click.top,f,c.height),h="y"===b.axis||u(N.left+O.click.left,e,c.width);else var e=c.left+G[d].offset.left,f=c.top+G[d].offset.top,g="x"===b.axis||u(N.top+a("#"+d).contents().scrollTop()+O.click.top,f,c.height),h="y"===b.axis||u(N.left+a("#"+d).contents().scrollLeft()+O.click.left,e,c.width);var i=g&&h,j=x(),k=y();return!!i&&(da?k&&"right"===k||"down"===j?2:1:j&&("down"===j?2:1))}function x(){var a=N.top-R.top;return 0!==a&&(a>0?"down":"up")}function y(){var a=N.left-R.left;return 0!==a&&(a>0?"right":"left")}function z(a){var b,c,d,e=$.length,f=_.length;for(b=e-1;b>=0;b--)c=$[b],c.instance!==aa&&aa||(t=c.item,a||(c.width=t.outerWidth(),c.height=t.outerHeight()),d=t.offset(),c.left=d.left,c.top=d.top);for(b=f-1;b>=0;b--)d=_[b].element.offset(),_[b].containerCache.left=d.left,_[b].containerCache.top=d.top,_[b].containerCache.width=_[b].element.outerWidth(),_[b].containerCache.height=_[b].element.outerHeight()}function A(){if("parent"==b.iframeSortable)a(b.dropInSortable).each(function(){_.push({element:a(this),containerCache:{left:0,top:0,width:0,height:0}});var c=a(this);b.items!==!1?a(this).children(b.items).not(b.cancelSortable).each(function(){$.push({top:0,left:0,height:0,width:0,item:a(this),instance:c})}):a(this).children().not(b.cancelSortable).each(function(){$.push({top:0,left:0,height:0,width:0,item:a(this),instance:c})})});else{var c="#"+b.iframeSortable;a(c)[0].contentWindow.jQuery(b.dropInSortable).each(function(){_.push({element:a(c)[0].contentWindow.jQuery(this),containerCache:{left:0,top:0,width:0,height:0}});var d=a(c)[0].contentWindow.jQuery(this);b.items!==!1?a(c)[0].contentWindow.jQuery(this).children(b.items).not(b.cancelSortable).each(function(){$.push({top:0,left:0,height:0,width:0,item:a(c)[0].contentWindow.jQuery(this),instance:d})}):a(c)[0].contentWindow.jQuery(this).children().not(b.cancelSortable).each(function(){$.push({top:0,left:0,height:0,width:0,item:a(c)[0].contentWindow.jQuery(this),instance:d})})})}}function B(){A(),z()}function C(a){var c,d=aa,e=Q;if(aa=null,Q=-2,f(a)===!1){for(null!==Z&&(Z.removeClass("sed-row-drop-area"),Z=null),c=_.length-1;c>=0;c--)if(!_[c].element.hasClass("sed-sortable-disabled")&&D(_[c].containerCache)){aa=_[c].element,Q=c,null!==d&&e!=Q&&b.out(a,d,b),b.over(a,aa,b);break}}else Z.addClass("sed-row-drop-area");null==aa&&(ca=ca.detach())}function D(c){var d=N.left,e=N.top,f=b.iframeSortable;if("parent"==f)var g=c.left,h=c.top;else{var g=c.left+G[f].offset.left,h=c.top+G[f].offset.top;d+=a("#"+f).contents().scrollLeft(),e+=a("#"+f).contents().scrollTop()}var i=(d+M.width,e+M.height,g+c.width),j=h+c.height,k=O.click.top,l=O.click.left,m="x"===b.axis||e+k>h&&e+k<j,n="y"===b.axis||d+l>g&&d+l<i,o=m&&n;return o}function E(b){K=H.css("position"),o(),L=H.offsetParent(),O={top:H.offset().top-J.top,left:H.offset().left-J.left},a.extend(O,{click:{left:b.pageX-O.left,top:b.pageY-O.top}}),I={top:O.top,left:O.left}}var b=a.extend({handle:null,cursor:"move",draggingClass:"dragging",helper:"clone",revert:!0,axis:!1,revertDuration:500,dropInSortable:!1,cancelSortable:!1,items:!1,iframeSortable:"parent",tolerance:"pointer",placeholder:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,dragStart:function(){},drag:function(){},stop:function(){},sortStop:function(){},out:function(){},over:function(){}},b),F=this;null!=b.handle&&(F=a(b.handle));var G={};"parent"!=b.iframeSortable&&(G[b.iframeSortable]={offset:{top:a("#"+b.iframeSortable).offset().top,left:a("#"+b.iframeSortable).offset().left}});var H,I,J,K,L,M,N,O,P,Q,R,S,T,U=!1,V=null,W=0,X=0,Y=!1,Z=null,$=[],_=[],aa=null,ba=null,ca=null,da=!1,ea=this;return a.fn.sedDraggable.destroy=function(){ea.unbind("mousedown"),ea.unbind("mousemove"),ea.unbind("mouseup")},F.css("cursor",b.cursor).on("mousedown",function(d){H=a(this),E(d),b.dropInSortable!==!1&&(B(),s(),da=!!$.length&&("x"===b.axis||v($[0].item)));var f=H.offset().left-d.pageX,g=H.offset().top-d.pageY,h=H.css("z-index");"original"!=b.helper&&c(d,b),V.css({"z-index":999,bottom:"auto",right:"auto"}),a(document.documentElement).on("mousemove.sedDraggable",function(a){null!=V&&(Y===!1&&(b.dragStart(a,H,V),Y=!0),V.offset({left:f+a.pageX,top:g+a.pageY}),N={top:g+a.pageY-J.top,left:f+a.pageX-J.left},R||(R=N),b.drag(a,H,V),b.scroll===!0&&n(a,b),b.dropInSortable!==!1&&(C(a),p(a,f,g)))}).one("mouseup",function(c){b.stop(c,H,V),e(c,a(this)),a(this).off("mousemove.sedDraggable"),H.css("z-index",h)}),d.preventDefault()}),this},a.SiteEditorDroppable={droppables:{parent:[]},currentIframe:"parent",scope:{parent:{top:0,left:0}},create:function(b){var c,d,e,f,g=b.options;if(g.iframe!==!1){if(e=g.iframe,c="#"+e,d=a(c),void 0===typeof d)return;b.targetWindow=a(c)[0].contentWindow,f=e,a.inArray(f,a.SiteEditorDroppable.scope)==-1&&(a.SiteEditorDroppable.scope[f]={top:d.offset().top,left:d.offset().left})}else f="parent",b.targetWindow="parent",g.addClasses&&this.element.$(b.selector).addClass("sed-iframe-droppable");a.isArray(a.SiteEditorDroppable.droppables[f])||(a.SiteEditorDroppable.droppables[f]=[]),a.SiteEditorDroppable.droppables[f].push(b)},destroy:function(b,c){var d=-1;a.each(a.SiteEditorDroppable.droppables,function(e,f){e==c&&(a.each(f,function(a,c){b==c.selector&&(d=a)}),d!=-1&&f.splice(d,1))})},fullDestroy:function(){a.SiteEditorDroppable.scope={parent:[]},a.SiteEditorDroppable.droppables={parent:{top:0,left:0}},a.SiteEditorDroppable.currentIframe="parent"},targetIframe:function(b,c){var d=null;for(prop in a.SiteEditorDroppable.scope)if("parent"!=prop&&a.SiteEditorDroppable.scope[prop].top<=c&&a.SiteEditorDroppable.scope[prop].left<=b){d=prop;break}return d=null==d?"parent":d}},a.sedDroppable=function(b,c){var c=a.extend({accept:"*",iframe:!1,activeClass:!1,addClasses:!0,hoverClass:!1,activate:null,deactivate:null,drop:function(){}},c),d={};d.options=c,d.selector=b,a.SiteEditorDroppable.create(d)}}(jQuery);