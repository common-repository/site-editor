(function( exports, $ ){
    
    var api = sedApp.editor;

    if ( ! api.previewPosts ) {
        api.previewPosts = {};
    }
    if ( ! api.previewPosts.data ) {
        api.previewPosts.data = {};
    }

    $( function() {
        
        //api.postsData = window._sedAppPreviewPostsData;

        //api.bind( 'preview-ready' , function() { alert("test....");
            api.preview.bind( 'active', function() {

                var settings = {};

                _.extend( api.previewPosts.data, window._sedAppPreviewPostsData );

                $.each( api.settings.values , function( id , value ) {

                    var settingProperties = api.previewPosts.data.settingProperties[ id ];

                    if ( ! api.has( id ) || ! settingProperties ) {
                        return;
                    }

                    settings[ id ] = {
                        value       : value,
                        dirty       : Boolean( api.settings._dirty[ id ] ),
                        option_type : settingProperties.option_type,
                        transport   : settingProperties.transport ,
                        type        : "general"
                    };

                } );

                var newData = {
                    isPostPreview: api.previewPosts.data.isPostPreview,
                    isSingular: api.previewPosts.data.isSingular,
                    queriedPostId: api.previewPosts.data.queriedPostId,
                    settings: settings
                };

                api.preview.send( 'syncPostsData', newData );

                api.Events.trigger( 'afterSyncPostsData' , newData );

            });
        //});

    });


})( sedApp, jQuery );